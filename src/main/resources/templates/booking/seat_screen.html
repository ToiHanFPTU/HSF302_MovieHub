<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chọn ghế</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .seat-btn {
            margin: 3px;
            width: 50px;
            height: 50px;
        }
        .selected {
            background-color: green;
            color: white;
        }
        .occupied {
            background-color: red;
            color: white;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-light">
<div class="container mt-4">
    <h3>Chọn ghế</h3>

    <form th:action="@{/book}" method="post" id="bookingForm">
        <!-- Ẩn showtimeId -->
        <input type="hidden" name="showtimeId" th:value="${showtimeId}"/>

        <div class="d-flex flex-wrap">
            <span th:each="seat : ${availableSeats}">
                <button type="button"
                        class="seat-btn btn"
                        th:text="${seat.seatNumber}"
                        th:data-seat-id="${seat.seatId}"
                        th:classappend="${seat.booked} ? 'occupied btn-danger' : 'btn-outline-primary'"
                        th:attr="disabled=${seat.booked} ? 'disabled' : null">
                </button>
            </span>
        </div>

        <!-- Hidden inputs cho seatIds -->
        <div id="seatInputs"></div>

        <button type="submit" class="btn btn-success mt-3">Đặt vé</button>
    </form>
</div>

<script>
    const seatButtons = document.querySelectorAll('.seat-btn');
    const seatInputsDiv = document.getElementById('seatInputs');

    seatButtons.forEach(btn => {
        // chỉ attach sự kiện cho ghế chưa booked
        if (!btn.classList.contains('occupied')) {
            btn.addEventListener('click', () => {
                const seatId = btn.getAttribute('data-seat-id');

                // toggle class selected
                btn.classList.toggle('selected');

                // update hidden inputs
                if (btn.classList.contains('selected')) {
                    // tạo input ẩn cho seatId
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'seatIds';
                    input.value = seatId;
                    input.id = 'seat-' + seatId;
                    seatInputsDiv.appendChild(input);
                } else {

                    const input = document.getElementById('seat-' + seatId);
                    if (input) seatInputsDiv.removeChild(input);
                }
            });
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
