<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chọn ghế</title>
    <link rel="stylesheet" href="/css/seat_screen.css">
</head>
<body>

<h2>Chọn ghế xem phim</h2>

<form id="bookingForm" action="/book" method="post">
    <input type="hidden" name="showtimeId" value="1" /> <!-- Thay showtimeId hiện tại -->

    <div class="seat-zone" data-zone="STANDARD" data-price="100000">
        <h3>Thường (100.000 VNĐ)</h3>
        <div class="seat-container" id="standardSeats"></div>
    </div>

    <div class="seat-zone" data-zone="VIP" data-price="150000">
        <h3>VIP (150.000 VNĐ)</h3>
        <div class="seat-container" id="vipSeats"></div>
    </div>

    <div class="seat-zone" data-zone="COUPLE" data-price="200000">
        <h3>Đôi (200.000 VNĐ)</h3>
        <div class="seat-container" id="coupleSeats"></div>
    </div>

    <!-- Hidden inputs cho seatIds -->
    <div id="seatInputs"></div>

    <div class="info-box">
        <p><strong>Ghế đã chọn:</strong> <span id="selectedSeats">Chưa chọn</span></p>
        <p><strong>Số lượng:</strong> <span id="seatCount" class="highlight">0</span></p>
        <p><strong>Tổng tiền:</strong> <span id="totalPrice" class="highlight">0 VNĐ</span></p>
    </div>

    <button type="submit" id="confirmBtn">Xác nhận đặt vé</button>
</form>

<script>
    // Tạm thời map seat_number -> seat_id (lấy từ DB)
    const seatMap = {
        "S01":1,"S02":2,"S03":3,"S04":4,"S05":5,"S06":6,"S07":7,"S08":8,"S09":9,"S10":10,
        "S11":11,"S12":12,"S13":13,"S14":14,"S15":15,"S16":16,"S17":17,"S18":18,"S19":19,"S20":20,
        "S21":21,"S22":22,"S23":23,"S24":24,"S25":25,"S26":26,"S27":27,"S28":28,"S29":29,"S30":30,
        "S31":31,"S32":32,"S33":33,"S34":34,"S35":35,"S36":36,"S37":37,"S38":38,"S39":39,"S40":40,
        "V01":41,"V02":42,"V03":43,"V04":44,"V05":45,"V06":46,"V07":47,"V08":48,"V09":49,"V10":50,
        "C01":51,"C02":52,"C03":53,"C04":54,"C05":55,"C06":56,"C07":57,"C08":58,"C09":59,"C10":60
    };

    const selectedSeats = [];

    // Tạo ghế động
    function createSeats(containerId, prefix, count) {
        const container = document.getElementById(containerId);
        for(let i=1;i<=count;i++){
            const seatNum = prefix + i.toString().padStart(2,'0');
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'seat';
            btn.dataset.seat = seatNum;
            btn.innerText = seatNum;
            container.appendChild(btn);

            btn.addEventListener('click', () => {
                if(btn.classList.toggle('selected')){
                    selectedSeats.push(seatNum);
                } else {
                    const idx = selectedSeats.indexOf(seatNum);
                    if(idx>-1) selectedSeats.splice(idx,1);
                }
                updateSummary();
            });
        }
    }

    createSeats('standardSeats','S',40);
    createSeats('vipSeats','V',10);
    createSeats('coupleSeats','C',10);

    function updateSummary(){
        document.getElementById('selectedSeats').innerHTML = selectedSeats.join(', ') || 'Chưa chọn';
        document.getElementById('seatCount').innerText = selectedSeats.length;

        let total = 0;
        selectedSeats.forEach(seat=>{
            if(seat.startsWith('S')) total+=100000;
            else if(seat.startsWith('V')) total+=150000;
            else total+=200000;
        });
        document.getElementById('totalPrice').innerText = total.toLocaleString('vi-VN')+' VNĐ';

        // Cập nhật hidden inputs seatIds
        const seatInputsDiv = document.getElementById('seatInputs');
        seatInputsDiv.innerHTML = '';
        selectedSeats.forEach(seat=>{
            const input = document.createElement('input');
            input.type='hidden';
            input.name='seatIds';
            input.value = seatMap[seat];
            seatInputsDiv.appendChild(input);
        });
    }

    // Form submit validation
    document.getElementById('bookingForm').addEventListener('submit', function(e){
        if(selectedSeats.length===0){
            e.preventDefault();
            alert('Vui lòng chọn ít nhất 1 ghế!');
        }
    });
</script>

</body>
</html>
