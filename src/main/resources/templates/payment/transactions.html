<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${isAdmin ? 'All Transactions' : 'My Transactions'}">Transactions</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/transactions.css">
</head>
<body>

<!-- Navbar -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Main Content -->
<div class="container">
    <!-- Page Header -->
    <div class="page-header">
        <h2 th:text="${isAdmin ? 'Tất cả giao dịch' : 'Giao dịch của tôi'}">Giao dịch của tôi</h2>
        <p class="page-subtitle">Quản lý và theo dõi các giao dịch thanh toán</p>
    </div>

    <!-- Filter Section -->
    <div class="filter-card">
        <form method="get" th:action="${isAdmin ? '/admin/transactions' : '/user/transactions'}">
            <div class="row align-items-end">
                <div class="col-md-4 mb-3 mb-md-0">
                    <label for="statusFilter" class="filter-label">Lọc theo trạng thái</label>
                    <select name="status" id="statusFilter" class="form-select" onchange="this.form.submit()">
                        <option value="">Tất cả trạng thái</option>
                        <option value="PENDING" th:selected="${selectedStatus == 'PENDING'}">Đang xử lý</option>
                        <option value="DONE" th:selected="${selectedStatus == 'DONE'}">Hoàn thành</option>
                        <option value="FAILED" th:selected="${selectedStatus == 'FAILED'}">Thất bại</option>
                    </select>
                </div>
                <div class="col-md-8">
                    <button type="button" class="btn-clear" onclick="window.location.href=window.location.pathname">
                        <i class="fas fa-times"></i> Xóa bộ lọc
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Transactions Table -->
    <div class="transactions-card">
        <div th:if="${transactions == null or transactions.isEmpty()}" class="empty-state">
            <i class="fas fa-receipt"></i>
            <h3>Chưa có giao dịch nào</h3>
            <p>Các giao dịch của bạn sẽ hiển thị ở đây</p>
        </div>

        <div th:unless="${transactions == null or transactions.isEmpty()}" class="table-container">
            <table class="custom-table">
                <thead>
                <tr>
                    <th>Mã GD</th>
                    <th>Số tiền</th>
                    <th>Phương thức</th>
                    <th>Trạng thái</th>
                    <th>Ngày giao dịch</th>
                    <th>Hành động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="transaction : ${transactions}">
                    <td>
                        <span class="transaction-id" th:text="'#' + ${transaction.id}">#1234</span>
                    </td>
                    <td>
                        <span class="amount" th:text="${#numbers.formatDecimal(transaction.totalAmount, 0, 'COMMA', 0, 'POINT')} + '₫'">100,000₫</span>
                    </td>
                    <td>
                        <span class="payment-method">
                            <i class="fas fa-credit-card payment-icon"></i>
                            <span th:text="${transaction.paymentMethod}">BANKING</span>
                        </span>
                    </td>
                    <td>
                        <span th:class="'status-badge ' +
                            (${transaction.status == 'PENDING'} ? 'status-pending' :
                            (${transaction.status == 'COMPLETED'} ? 'status-completed' : 'status-failed'))">
                            <i th:class="'fas ' +
                                (${transaction.status == 'PENDING'} ? 'fa-clock' :
                                (${transaction.status == 'COMPLETED'} ? 'fa-check-circle' : 'fa-times-circle'))"></i>
                            <span th:text="${transaction.status == 'PENDING'} ? 'Đang xử lý' :
                                (${transaction.status == 'COMPLETED'} ? 'Hoàn thành' : 'Thất bại')">Đang xử lý</span>
                        </span>
                    </td>
                    <td>
                        <span class="transaction-date" th:text="${#temporals.format(transaction.transactionDate, 'dd/MM/yyyy HH:mm')}">11/11/2025 10:00</span>
                    </td>
                    <td>
                        <form th:action="@{'/payment/form/' + ${transaction.id}}" method="get">
                            <button type="submit" class="btn-payment">Thanh toán</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Back Button -->
    <div class="action-buttons">
        <a href="/movies" class="btn-back">
            <i class="fas fa-arrow-left"></i> Về trang chủ
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>